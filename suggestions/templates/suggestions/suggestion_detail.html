{% extends 'suggestions/base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>{{object.title}}</h2>
    <p>{{object.description}}</p>
    <p><small>By {{object.author.username}} on {{object.created_at|date:"M d, Y"}}</small></p>
    <hr>
    {% if user.is_authenticated %}
    <form action="" method="post" class="mt-3">
        {% csrf_token %}
        <div>
        {{ form.text.errors }}
        {{ form.text }}
    </div>
    <br>
        <button type="submit" class="btn btn-primary btn-sm w-auto">Add comment</button>
    </form>
    {% else %}
    <p><a href="{% url 'suggestion:login' %}">Login to comment</a></p>
    {% endif %}

    <h5>Comments:</h5>
    {% for comment in object.comments.all  %}
        <div class="mb-2 p-2 border rounded bg-light">
            <strong>{{ comment.author.username }}</strong>:{{ comment.text }}
            <br>
            <small class="text-muted">{{ comment.created_at|timesince }} ago</small>
            {% if user == comment.author %}
                <a href="{% url 'suggestion:comment_delete' comment.pk %}" class="float-end"><span class="bi bi-trash"></span></a>
            {% endif %}
            <hr>
            {% if user.is_authenticated %}
            <form action="{% url 'suggestion:upvote' suggestion_pk=suggestion.id comment_pk=comment.id %}" method="post">
                {% csrf_token %}
                {% if user in comment.upvote.all %}
                <button type="submit" class="btn btn-success bi bi-arrow-up float-end"></button>
                {% else %}
                <button type="submit" class="btn btn-success bi bi-arrow-up-circle-fill float-end"></button>
                {% endif %}
            </form>
            {% endif %}
            <p>{{ comment.total_upvotes }} upvotes</p>
        </div>
        {% empty %}
            <p>No Comments</p>
    {% endfor %}
</div>
{% endblock content %}
